#+TITLE: Virtual Labs College Cloud Edition Performance testing - CPU Testing
#+DATE: [2017-04-24]
#+PROPERTY: results output
#+PROPERTY: exports code
#+SETUPFILE: ../org-templates/level-1.org
#+options: ^:nil
#+LATEX: Literal LaTeX code for export


* Introduction
  This document is a Test Suite for multiple test cases with clear
  objectives and inferences defined for each test performed.


* Test Suite : CPU Testing (Full version of College Cloud Edition)
** Introduction    
  |-----------------------+-----------------------------------------------------------------|
  | Id, Name              | PTEST-FULLCC-001 (Performance Test full CC)                     |
  |-----------------------+-----------------------------------------------------------------|
  | Overall Objective(s)  | To identify the following                                       |
  |                       | a. CPU utilization                                              |
  |                       | b. Swap IO time                                                 |
  |                       | c. Wait time                                                    |
  |                       | d. Page faults                                                  |
  |                       | e. context switches                                             |
  |                       | d. Memory (RAM) utilization                                     |
  |-----------------------+-----------------------------------------------------------------|
  | Description           | In having multiple different scenarios,                         |
  |                       | testing college cloud for above given parameters .              |
  |                       | Description for individual tests will be given in               |
  |                       | each test section.                                              |
  |-----------------------+-----------------------------------------------------------------|
  | Configuration/Context | a. College cloud full version (running from single machine)     |
  |                       | b. College cloud Split version (running from diffrent machines) |
  |                       | c. Variable load                                                |
  |-----------------------+-----------------------------------------------------------------|

** System Configuration/Context for below test cases
    + Full CC version 
    + Open edX running 
    + All components running from a single machine
    + 16 GB RAM / I7 


* Test cases 

** PTEST-FULLCC-001 : TEST01 - vmstat - No load
*** Objective(s)
    To identify the following stats - 
    + CPU run queues
    + Swap in/out
    + Wait time for IO 
    + Memory (RAM) utilization

    when no load on College Cloud and running cluster components.

    + NOTE :: *no load* means, no user requests on college cloud

*** Description
    [[http://www.linuxcommand.org/man_pages/vmstat8.html][vmstat]] - Virtual memory stats is a command to get summary
    information on Memory, Processess, CPU, Paging etc.
    
    + Boot CC normally
    + Use the command given below to get statistics -
      #+BEGIN_SRC command
      vmstat 1 1200 -n -w -S M 
      #+END_SRC
    + This command runs for 1200 times and returns output on screen
      every one second.
    + *-S M* is to get output in MB

*** Performance measurements
    + CPU utilization / unit
    + Memory utilization / unit
   
*** Experiment and result
    + [[./raw-data/no-load-run-1-vagrant-up.txt][Raw-Data]]
    + Graph-01 Free RAM / IDLE RAM graph
      The graph given below infers the following -
      + Free RAM / Idle RAM captured at an instance of test. (There
        were 1200 test instances since we ran =vmstat 1 1200 -n -w -S
        M= command for 1200 seconds). To understand =vmstat= command,
        please look at [[./manuals/command-manuals.org][this example]]
      + Value for FREE RAM is graphed below -
         |------+-------------|
         | Stat | RAM (in MB) |
         |------+-------------|
         | Max  |        6904 |
         |------+-------------|
         | Min  |        6821 |
         |------+-------------|
         
      [[./graphs/free-ram-graph.png]]

    + Graph-02 Number of processes waiting for runtime 
      The graph given below infers the following -
      + Number of processes waiting for runtime at an instance of test.
     
      [[./graphs/no-of-process-waiting-for-runtime-no-load.png]]

    + Graph-03 IDLE CPU at an instance of test 
      The graph given below inferes the following -
      + IDLE CPU percentage at an instance of test. 
        [[graphs/idle-cpu.png]]
	

** PTEST-FULLCC-001 : TEST02 - vmstat - Simple load( 20 concurrent user requests on one lab for 20 minutes)
*** Objective(s)
    To identify the following stats - 
    + CPU run queues
    + Swap in/out
    + Wait time for IO 
    + Memory (RAM) utilization

    when one lab is up and load 20 concurrent user requests for 20 minutes.



*** Description
    [[http://www.linuxcommand.org/man_pages/vmstat8.html][vmstat]] - Virtual memory stats is a command to get summary
    information on Memory, Processess, CPU, Paging etc.
    
    + Boot CC normally
    + Start one lab container
      #+BEGIN_SRC 
      vzctl start <CTID>
      #+END_SRC
    + Use the command given below to get statistics -
      #+BEGIN_SRC command
      vmstat 1 1200 -n -w -S M 
      #+END_SRC
    + This command runs for 1200 times and returns output on screen
      every one second.
    + *-S M* is to get output in MB

*** Performance measurements
    + CPU utilization / unit
    + Memory utilization / unit
   
*** Experiment and result
    + Boot CC normally 
    + Start one lab container
      #+BEGIN_SRC 
      vzctl start <CTID>
      #+END_SRC
    + Use the command given below on CC machine  to get statistics -
      #+BEGIN_SRC command
      vmstat 1 1200 -n -w -S M 
      #+END_SRC
      - To understand =vmstat= command, please look at [[./manuals/command-manuals.org][this example]]
    + This command runs for 1200 times and returns output on screen
      every one second.
    + *-S M* is to get output in MB
    + Now, put load on the lab using *siege* command. Run the below
      command from different machine which is connected to CC through
      LAN
      #+BEGIN_SRC 
      siege -c 20 -r 1 -t 20M http://cse01-iiith.vlabs.ac.in/
      #+END_SRC
    + Output of the above command can be found at [[./raw-data/one-lab-20-concurrent-requests-20min-siege.txt][Raw-Data]]

         
    
** PTEST-FULLCC-001 : TEST03 - vmstat - 50 concurrent user requests on one lab for 20 minutes
*** Objective(s)
    To identify the following stats - 
    + CPU run queues
    + Swap in/out
    + Wait time for IO 
    + Memory (RAM) utilization

    when one lab is up and load 50 concurrent user requests for 20
    minutes.

*** Description
    [[http://www.linuxcommand.org/man_pages/vmstat8.html][vmstat]] - Virtual memory stats is a command to get summary
    information on Memory, Processess, CPU, Paging etc.
    
    + Boot CC normally
    + Start one lab container
      #+BEGIN_SRC 
      vzctl start <CTID>
      #+END_SRC
    + Use the command given below to get statistics -
      #+BEGIN_SRC command
      vmstat 1 1200 -n -w -S M 
      #+END_SRC
    + This command runs for 1200 times and returns output on screen
      every one second.
    + *-S M* is to get output in MB

*** Performance measurements
    + CPU utilization / unit
    + Memory utilization / unit
   
*** Experiment and result
    + Boot CC normally 
    + Start one lab container
      #+BEGIN_SRC 
      vzctl start <CTID>
      #+END_SRC
    + Use the command given below on CC machine  to get statistics -
      #+BEGIN_SRC command
      vmstat 1 1200 -n -w -S M 
      #+END_SRC
      - To understand =vmstat= command, please look at [[./manuals/command-manuals.org][this example]]
    + This command runs for 1200 times and returns output on screen
      every one second.
    + *-S M* is to get output in MB
    + Now, put load on the lab using *siege* command. Run the below
      command from different machine which is connected to CC through
      LAN
      #+BEGIN_SRC 
      siege -c 50 -r 1 -t 20M http://cse01-iiith.vlabs.ac.in/
      #+END_SRC
    + Output of the above command can be found at [[./raw-data/one-lab-20-concurrent-requests-20min-siege.txt][Raw-Data]]

         

** PTEST-FULLCC-001 : TEST04 - vmstat - 50 concurrent user requests on edx platform for 20 minutes
*** Objective(s)
    To identify the following stats - 
    + CPU run queues
    + Swap in/out
    + Wait time for IO 
    + Memory (RAM) utilization
   when one lab container is running and 50 concurrent user requests
   on edx home page (http://vlabs.ac.in) for 20 minutes.


*** Description
    Will be identifying CPU, Swap, Memory, etc utilization using
    *vmstat.

    [[http://www.linuxcommand.org/man_pages/vmstat8.html][vmstat]] - Virtual memory stats is a command to get summary
    information on Memory, Processess, CPU, Paging etc.
    

*** Performance measurements
    + CPU utilization / unit
    + Memory utilization / unit
   
*** Experiment and result
    + Boot CC normally 
    + Make sure edx platform is up and running.
      - If edx platform is not running,then run the below commands
        from =vlabs= user account
	#+BEGIN_EXAMPLE
        cd vagrant-boxes
        vagrant up
        vagrant up --provision
	#+END_EXAMPLE
    + Start one lab container
      #+BEGIN_SRC 
      vzctl start <CTID>
      #+END_SRC
    + Use the command given below on CC machine  to get statistics -
      #+BEGIN_SRC command
      vmstat 1 1200 -n -w -S M 
      #+END_SRC
      - To understand =vmstat= command, please look at [[./manuals/command-manuals.org][this example]]
    + This command runs for 1200 times and returns output on screen
      every one second.
    + *-S M* is to get output in MB
    + Now, put load on the lab using *siege* command. Run the below
      command from different machine which is connected to CC through
      LAN
      #+BEGIN_SRC 
      siege -c 50 -t 20M http://vlabs.ac.in/
      #+END_SRC
    + Output of the above command can be found at [[./raw-data/edx-home-page-one-lab-50-concurrent-users-requests-20min.txt][Raw-Data]]

         

** PTEST-FULLCC-001 : TEST05 - vmstat - 50 concurrent user requests on feedback-service for 20 minutes
*** Objective(s)
    To identify the following stats - 
    + CPU run queues
    + Swap in/out
    + Wait time for IO 
    + Memory (RAM) utilization
   when one lab container is running and 50 concurrent user requests
   on feedback service page (http://feedbac.vlabs.ac.in) for 20
   minutes.


*** Description
    Will be identifying CPU, Swap, Memory, etc utilization using
    *vmstat.

    [[http://www.linuxcommand.org/man_pages/vmstat8.html][vmstat]] - Virtual memory stats is a command to get summary
    information on Memory, Processess, CPU, Paging etc.
    

*** Performance measurements
    + CPU utilization / unit
    + Memory utilization / unit
   
*** Experiment and result
    + Boot CC normally 
    + Make sure feedback service/container is up and running.
    + Start one lab container
      #+BEGIN_SRC 
      vzctl start <CTID>
      #+END_SRC
    + Use the command given below on CC machine  to get statistics -
      #+BEGIN_SRC command
      vmstat 1 1200 -n -w -S M 
      #+END_SRC
      - To understand =vmstat= command, please look at [[./manuals/command-manuals.org][this example]]
    + This command runs for 1200 times and returns output on screen
      every one second.
    + *-S M* is to get output in MB
    + Now, put load on the lab using *siege* command. Run the below
      command from different machine which is connected to CC through
      LAN
      #+BEGIN_SRC 
      siege -c 50 -t 20M http://feedback.vlabs.ac.in/
      #+END_SRC
    + Output of the above command can be found at [[./raw-data/feedback-plus-onelab-50-concurrent-users-requests-20min.txt][Raw-Data]]

         

** PTEST-FULLCC-001 : TEST07 - mpstat - No load
*** Objective(s)
    To identify the following stats - 
    + CPU run queues
    when no load on College Cloud and running cluster components.

    + NOTE :: *no load* means, no user requests on college cloud

*** Description
    Identify processors utilization using *mpstat* command line tool.
    *mpstat* - Report processors related statistics.
    
    + Use the command given below to get statistics of all available
      processors
      #+BEGIN_SRC command
      mpstat 1 -P ALL 1200
      #+END_SRC
    + This command runs for 1200 records/times and returns processors
      utilization output on screen every one second.
      - [[./index.org::#understand_mpstat][mpstat help manual is here]]

*** Performance measurements
    + CPU utilization / unit
   
*** Experiment and result
    + Boot CC normally 
    + Use the command given below on CC machine  to get statistics of
      all available processors.
      #+BEGIN_SRC command
      mpstat 1 -P ALL 12000
      #+END_SRC
      - To understand =mpstat= command, please look at [[./manuals/command-manuals.org][mpstat help manual is here]]
    + This command runs for 1200 times and returns output on screen
      every one second.
    + Output of the above command can be found at [[./raw-data/mpstat-no-load-with-vagrant-up-20min.txt][Raw-Data]]


** PTEST-FULLCC-001 : TEST08 - mpstat - Simple load( 20 concurrent user requests on one lab for 20 minutes)
*** Objective(s)
    To identify the following stats - 
    + CPU run queues
    when one lab is up and load 20 concurrent user requests for 20 minutes.

*** Description
    Identify processors utilization using *mpstat* command line tool.
    *mpstat* - Report processors related statistics.
    
    + Use the command given below to get statistics of all available
      processors
      #+BEGIN_SRC command
      mpstat 1 -P ALL 1200
      #+END_SRC
    + This command runs for 1200 records/times and returns processors
      utilization output on screen every one second.
      - [[./index.org::#understand_mpstat][mpstat help manual is here]]

*** Performance measurements
    + CPU utilization / unit
   
*** Experiment and result
    + Boot CC normally 
    + Start one lab container
      #+BEGIN_SRC 
      vzctl start <CTID>
      #+END_SRC
    + Use the command given below on CC machine  to get statistics of
      all available processors.
      #+BEGIN_SRC command
      mpstat 1 -P ALL 12000
      #+END_SRC
      - To understand =mpstat= command, please look at [[./manuals/command-manuals.org][mpstat help manual is here]]
    + This command runs for 1200 times and returns output on screen
      every one second.
    + Output of the above command can be found at [[./raw-data/mpstat-20-concurrent-user-requests-with-vagrant-up-onelab-up-20min.txt][Raw-Data]]
    + Now, put load on the lab using *siege* command. Run the below
      command from different machine which is connected to CC through
      LAN
      #+BEGIN_SRC 
      siege -c 20 -t 20M http://cse01-iiith.vlabs.ac.in/
      #+END_SRC
      - Look at [[./manuals/command-manuals.org][siege help manual]]
    + Output of the above siege command can be found at [[./raw-data/mpstat-20-concurrent-user-requests-20min-siege.txt][Raw-Data]]

         

** PTEST-FULLCC-001 : TEST09 - mpstat - 50 concurrent user requests on one lab for 20 minutes
*** Objective(s)
    To identify the following stats - 
    + CPU run queues
    when one lab is up and load 50 concurrent user requests for 20
    minutes.

*** Description
    Identify processors utilization using *mpstat* command line tool.
    *mpstat* - Report processors related statistics.
    
    + Use the command given below to get statistics of all available
      processors
      #+BEGIN_SRC command
      mpstat 1 -P ALL 1200
      #+END_SRC
    + This command runs for 1200 records/times and returns processors
      utilization output on screen every one second.
      - [[./index.org::#understand_mpstat][mpstat help manual is here]]

*** Performance measurements
    + CPU utilization / unit
   
*** Experiment and result
    + Boot CC normally 
    + Start one lab container
      #+BEGIN_SRC 
      vzctl start <CTID>
      #+END_SRC
    + Use the command given below on CC machine  to get statistics of
      all available processors.
      #+BEGIN_SRC command
      mpstat 1 -P ALL 12000
      #+END_SRC
      - To understand =mpstat= command, please look at [[./manuals/command-manuals.org][mpstat help
        manual is here]]

    + This command runs for 1200 times and returns output on screen
      every one second.
    + Output of the above command can be found at [[./raw-data/mpstat-50-concurrent-user-requests-with-vagrant-up-onelab-up-20min.txt][mpstat-raw-data]]
    + Now, put load on the lab using *siege* command. Run the below
      command from different machine which is connected to CC through
      LAN
      #+BEGIN_SRC 
      siege -c 50 -t 20M http://cse01-iiith.vlabs.ac.in/
      #+END_SRC
      - Look at [[./manuals/command-manuals.org][siege help manual]]
    + Output of the above siege command can be found at [[./raw-data/mpstat-50-concurrent-user-request-siege.txt][siege-raw-data]]

         


** PTEST-FULLCC-001 : TEST10 - mpstat - 50 concurrent user requests on edx platform for 20 minutes
*** Objective(s)
    To identify the following stats - *CPU usage*
    when one lab is up and load 50 concurrent user requests on edx
    platform for 20 minutes.

*** Description
    Identify processors utilization using *mpstat* command line tool.
    *mpstat* - Report processors related statistics.
    
    + Use the command given below to get statistics of all available
      processors
      #+BEGIN_SRC command
      mpstat 1 -P ALL 1200
      #+END_SRC
    + This command runs for 1200 records/times and returns processors
      utilization output on screen every one second.
      - [[./manuals/command-manuals.org][mpstat help manual is here]] or *Understanding mpstat smaple output*

*** Performance measurements
    + CPU utilization / unit
   
*** Experiment and result
    + Boot CC normally 
    + Make sure edx platform is up and running.
      - If edx platform is not running,then run the below commands
        from =vlabs= user account
	#+BEGIN_EXAMPLE
        cd vagrant-boxes
        vagrant up
        vagrant up --provision
	#+END_EXAMPLE
    + Start one lab container
      #+BEGIN_SRC 
      vzctl start <CTID>
      #+END_SRC
    + Use the command given below on CC machine  to get statistics of
      all available processors.
      #+BEGIN_SRC command
      mpstat 1 -P ALL 12000
      #+END_SRC
      - To understand =mpstat= command, please look at [[./manuals/command-manuals.org][mpstat help manual is here]]
    + This command runs for 1200 times and returns output on screen
      every one second.
    + Output of the above command can be found at [[./raw-data/mpstat-50-concurrent-user-requests-edx-homepage-onelab-up-20min.txt][mpstat raw-data]]
    + Now, put load on the lab using *siege* command. Run the below
      command from different machine which is connected to CC through
      LAN
      #+BEGIN_SRC 
      siege -c 50 -t 20M http://vlabs.ac.in/
      #+END_SRC
      - Look at [[./manuals/command-manuals.org][siege help manual]]
    + Output of the above siege command can be found at [[./raw-data/mpstat-50-concurrent-user-requests-edx-homepage-siege.txt][siege raw-data]]

         


